{
	"$schema": "https://raw.githubusercontent.com/flatpak/flatpak-builder/main/data/flatpak-manifest.schema.json",
	"id": "moe.scsi.Squishy",
	"runtime": "org.kde.Platform",
	"runtime-version": "5.15-22.08",
	"sdk": "org.kde.Sdk",

	"command": "python",
	"finish-args": ["--share=ipc", "--filesystem=host" ],
	"cleanup": [
		"/include",
		"/man",
		"/share/man",
		"/share/info",
		"/lib/*.la",
		"/lib/pkgconfig"
	],
	"modules": [
		{
			"name": "libusb",
			"config-opts": [ "--disable-static" ],
			"sources": [
				{
					"type": "archive",
					"url": "https://github.com/libusb/libusb/releases/download/v1.0.26/libusb-1.0.26.tar.bz2",
					"sha256": "12ce7a61fc9854d1d2a1ffe095f7b5fac19ddba095c259e6067a46500381b5a5"
				}
			]
		},
		{
			"name": "tcl",
			"buildsystem": "autotools",
			"config-opts": [
				"--enable-64-bit",
				"--prefix=/app",
				"--enable-symbols"
			],
			"post-install": [
				"chmod 755 /app/lib/libtcl8.6.so"
			],
			"subdir": "unix",
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/tcltk/tcl.git",
					"commit": "eea5dba"
				}
			]
		},
		{
			"name": "ncurses",
			"buildsystem": "autotools",
			"sources": [
				{
					"type": "archive",
					"url": "https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz",
					"sha256": "97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059"
				}
			]
		},
		{
			"name": "libreadline",
			"buildsystem": "autotools",
			"config-opts": [
				"--with-curses"
			],
			"make-install-args": [
				"SHLIB_LIBS=-lncursesw -ltinfo"
			],
			"make-args": [
				"SHLIB_LIBS=-lncursesw -ltinfo"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://ftp.gnu.org/gnu/readline/readline-8.1.tar.gz",
					"sha256": "f8ceb4ee131e3232226a17f51b164afc46cd0b9e6cef344be87c65962cb82b02"
				}
			]
		},
		{
			"name": "libffi",
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/libffi/libffi.git",
					"tag": "v3.4.3"
				}
			]
		},
		{
			"name": "eigen",
			"buildsystem": "cmake-ninja",
			"builddir": true,
			"sources": [
				{
					"type": "archive",
					"url": "https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.bz2",
					"sha256": "b4c198460eba6f28d34894e3a5710998818515104d6e74e5cc331ce31e46e626",
					"x-checker-data": {
						"type": "anitya",
						"project-id": 666,
						"stable-only": true,
						"url-template": "https://gitlab.com/libeigen/eigen/-/archive/$version/eigen-$version.tar.bz2"
					}
				}
			]
		},
		{
			"name": "boost",
			"buildsystem": "simple",
			"build-commands": [
				"./bootstrap.sh --prefix=/app --with-libraries=system,python,filesystem,program_options,iostreams,thread",
				"./b2 -j $FLATPAK_BUILDER_N_JOBS install"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://boostorg.jfrog.io/artifactory/main/release/1.78.0/source/boost_1_78_0.tar.bz2",
					"sha256": "8681f175d4bdb26c52222665793eef08490d7758529330f98d3b29dd0735bccc"
				}
			]
		},
		{
			"name": "yosys",
			"buildsystem": "simple",
			"build-commands": [
				"make -j $FLATPAK_BUILDER_N_JOBS PREFIX=\"/app\"",
				"make STRIP=':' PREFIX=\"/app\" install"
			],
			"sources": [
				{
					"type": "file",
					"path": "Makefile.conf",
					"sha256": "419691b9f43f9a79e47e6fe55daf738856c8be6e2b196f0e9cd304df46936e71"
				},
				{
					"type": "git",
					"url": "https://github.com/YosysHQ/yosys.git",
					"tag": "yosys-0.21"
				},
				{
					"type": "git",
					"dest": "abc",
					"url": "https://github.com/YosysHQ/abc.git",
					"commit": "20f970f"
				}
			]
		},
		{
			"name": "prjtrellis",
			"buildsystem": "cmake-ninja",
			"subdir": "libtrellis",
			"config-opts": [
				"-DCMAKE_INSTALL_PREFIX=/app",
				"-DCMAKE_BUILD_TYPE=RelWithDebInfo",
				"-DCURRENT_GIT_VERSION=488f4e7"
			],
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/YosysHQ/prjtrellis.git",
					"commit": "488f4e7"
				}
			]
		},
		{
			"name": "icestorm-partial",
			"buildsystem": "simple",
			"build-commands": [
				"make CXX=g++ PREFIX=/app -C icebox",
				"make CXX=g++ PREFIX=/app -C icetime",
				"make CXX=g++ PREFIX=/app -C icepack",
				"make PREFIX=/app -C icebox install",
				"make PREFIX=/app -C icetime install",
				"make PREFIX=/app -C icepack install"
			],
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/YosysHQ/icestorm.git",
					"commit": "a545498"
				}
			]
		},
		{
			"name": "nextpnr",
			"buildsystem": "cmake-ninja",
			"config-opts": [
				"-DARCH=ice40,ecp5",
				"-DBUILD_PYTHON=ON",
				"-DBUILD_GUI=OFF",
				"-DCMAKE_INSTALL_PREFIX=/app",
				"-DCMAKE_BUILD_TYPE=RelWithDebInfo",
				"-DCMAKE_EXE_LINKER_FLAGS=-ldl"
			],
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/YosysHQ/nextpnr.git",
					"tag": "nextpnr-0.4"
				}
			]
		}
	]
}
